{
    "summary": "Get User Permissions",
    "description": "Retrieve all permissions assigned to the authenticated user.\n\n\nThis endpoint returns a complete list of permissions that the current authenticated \nuser has access to. Permissions control what actions a user can perform across \ndifferent modules and entities in the system.\n\n\n**Use this endpoint to:**\n- Get user's complete permission set after login\n- Build dynamic UI (show/hide features based on permissions)\n- Implement client-side authorization checks\n- Display user capabilities in admin panels\n- Validate user access before performing actions\n\n**Typical flow:**\n```\n1. User logs in â†’ Gets auth token\n2. Frontend calls /api/permissions â†’ Gets permission list\n3. Frontend stores permissions locally\n4. UI renders based on permissions (show/hide buttons, menus)\n5. Before API calls, check if user has permission\n```\n\n\nPermissions follow a hierarchical naming convention:\n\n```\n{module}.{entity}.{action}\n```\n\n\n**1. Module** - Application module/domain\n- Examples: `security`, `catalog`, `sales`, `auths`\n- Represents a logical grouping of functionality\n- Typically prefixed with `mod_` for modular architecture\n\n**2. Entity** - Resource/Entity within the module\n- Examples: `users`, `roles`, `products`, `orders`\n- Represents the data model being accessed\n- Usually plural form\n\n**3. Action** - Operation being performed\n- CRUD: `index`, `store`, `show`, `update`, `destroy`\n- Custom: `action-validate`, `export-excel`, `export-pdf`\n- Bulk: `update-multiple`, `delete-by-id`\n- Special: `login`, `refresh`, `user-profile`\n\n\n```json\n// Security Module - User Management\n\"__VAR:module__.users.index\"         // List users\n\"__VAR:module__.users.store\"         // Create user\n\"__VAR:module__.users.show\"          // View user details\n\"__VAR:module__.users.update\"        // Update user\n\"__VAR:module__.users.destroy\"       // Delete user\n\"__VAR:module__.users.export-excel\"  // Export users to Excel\n\n// Security Module - Role Management\n\"__VAR:module__.roles.index\"         // List roles\n\"__VAR:module__.roles.store\"         // Create role\n\"__VAR:module__.roles.update\"        // Update role\n\n// Authentication Permissions\n\"auths.login\"                      // Can login\n\"auths.logout\"                     // Can logout\n\"auths.refresh\"                    // Can refresh token\n\"auths.user-profile\"               // Can view own profile\n\n// Special Permissions\n\"permissions.modules\"              // Can view modules list\n```\n\n\n**Method:** GET\n\n**Content-Type:** Not required (no body)\n\n**Required Headers:**\n- `Authorization: Bearer {token}` - Valid authentication token\n\n**Request Body:** None\n\n**Example Request:**\n```bash\nGET /api/permissions\nHeaders:\n  Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGc...\n  Accept: application/json\n```\n\n\nReturns an object where:\n- **Keys** - Permission IDs (integers as strings)\n- **Values** - Permission names (string format: `{module}.{entity}.{action}`)\n\n**Response Structure:**\n```json\n{\n  \"permission_id\": \"permission.name\",\n  \"permission_id\": \"permission.name\",\n  ...\n}\n```\n\n**Complete Example:**\n```json\n{\n  \"238\": \"__VAR:module__.__VAR:entity__.action-validate\",\n  \"239\": \"__VAR:module__.__VAR:entity__.update-multiple\",\n  \"240\": \"__VAR:module__.__VAR:entity__.export-excel\",\n  \"241\": \"__VAR:module__.__VAR:entity__.export-pdf\",\n  \"242\": \"__VAR:module__.__VAR:entity__.delete-by-id\",\n  \"244\": \"__VAR:module__.__VAR:entity__.index\",\n  \"245\": \"__VAR:module__.__VAR:entity__.store\",\n  \"243\": \"__VAR:module__.__VAR:entity__.update\",\n  \"247\": \"__VAR:module__.__VAR:entity__.destroy\",\n  \"1\": \"auths.login\",\n  \"2\": \"auths.admin-login\",\n  \"3\": \"auths.register\",\n  \"7\": \"auths.logout\",\n  \"8\": \"auths.refresh\",\n  \"9\": \"auths.user-profile\",\n  \"10\": \"permissions.modules\",\n  \"248\": \"__VAR:module__.__VAR:other_entity__.action-validate\",\n  \"249\": \"__VAR:module__.__VAR:other_entity__.update-multiple\",\n  \"250\": \"__VAR:module__.__VAR:other_entity__.export-excel\",\n  \"251\": \"__VAR:module__.__VAR:other_entity__.export-pdf\",\n  \"252\": \"__VAR:module__.__VAR:other_entity__.delete-by-id\",\n  \"254\": \"__VAR:module__.__VAR:other_entity__.index\",\n  \"255\": \"__VAR:module__.__VAR:other_entity__.store\",\n  \"256\": \"__VAR:module__.__VAR:other_entity__.show\",\n  \"257\": \"__VAR:module__.__VAR:other_entity__.destroy\"\n}\n```\n\n**Response Characteristics:**\n- **Format:** Plain JSON object (not wrapped in `data`)\n- **Keys:** String representation of integer IDs\n- **Values:** Permission names in dot notation\n- **Order:** Not guaranteed (treat as unordered set)\n- **Size:** Varies by user role (admin has more, regular user has less)\n\n\n\n**1. Authentication Permissions** (`auths.*`)\n```json\n{\n  \"1\": \"auths.login\",\n  \"2\": \"auths.admin-login\",\n  \"3\": \"auths.register\",\n  \"7\": \"auths.logout\",\n  \"8\": \"auths.refresh\",\n  \"9\": \"auths.user-profile\"\n}\n```\n- Basic authentication operations\n- Usually granted to all authenticated users\n\n**2. Module Permissions** (`__VAR:module__.*`)\n```json\n{\n  \"244\": \"__VAR:module__.__VAR:entity__.index\",\n  \"254\": \"__VAR:module__.__VAR:other_entity__.index\"\n}\n```\n- Organized by application module\n- Typically restricted based on user role\n\n**3. CRUD Permissions**\n```json\n{\n  \"244\": \"__VAR:module__.__VAR:entity__.index\",      // List/Read\n  \"245\": \"__VAR:module__.__VAR:entity__.store\",      // Create\n  \"243\": \"__VAR:module__.__VAR:entity__.update\",     // Update\n  \"247\": \"__VAR:module__.__VAR:entity__.destroy\"     // Delete\n}\n```\n- Standard resource operations\n- Follow RESTful naming conventions\n\n**4. Special Action Permissions**\n```json\n{\n  \"238\": \"__VAR:module__.__VAR:entity__.action-validate\",\n  \"239\": \"__VAR:module__.__VAR:entity__.update-multiple\",\n  \"240\": \"__VAR:module__.__VAR:entity__.export-excel\",\n  \"241\": \"__VAR:module__.__VAR:entity__.export-pdf\",\n  \"242\": \"__VAR:module__.__VAR:entity__.delete-by-id\"\n}\n```\n- Custom business operations\n- Bulk operations\n- Export/Import operations\n- Validation endpoints\n\n\nReturned when user is not authenticated or token is invalid.\n\n**Common Causes:**\n- Authorization header missing\n- Token expired\n- Token invalid or tampered\n- User logged out (token blacklisted)\n\n**Example:**\n```json\n{\n  \"message\": \"Unauthenticated.\"\n}\n```\n\n**Action Required:**\n- Redirect user to login page\n- Clear stored tokens\n- Request fresh authentication\n\nReturned when user doesn't have permission to view permissions list.\n\n**Example:**\n```json\n{\n  \"message\": \"This action is unauthorized.\"\n}\n```\n\n**Action Required:**\n- Check user role configuration\n- Contact administrator\n- User may need elevated privileges\n\nUnexpected server error while retrieving permissions.\n\n**Example:**\n```json\n{\n  \"message\": \"Unable to retrieve permissions.\",\n  \"error_id\": \"err_perm_abc123\"\n}\n```\n\n**Action Required:**\n- Retry request once\n- If persists, work with cached permissions\n- Contact support with error_id\n\n\n```javascript\n// ============================================\n// PERMISSION MANAGER - Complete Implementation\n// ============================================\n\nclass PermissionManager {\n  constructor() {\n    this.permissions = null;\n    this.permissionArray = null;\n  }\n  \n  /**\n   * Fetch and store user permissions\n   */\n  async fetchPermissions() {\n    const token = localStorage.getItem('auth_token');\n    \n    if (!token) {\n      console.error('No auth token found');\n      return null;\n    }\n    \n    try {\n      const response = await fetch('/api/permissions', {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer __JSON:token__`,\n          'Accept': 'application/json'\n        }\n      });\n      \n      if (!response.ok) {\n        if (response.status === 401) {\n          console.log('Unauthorized - redirecting to login');\n          localStorage.clear();\n          window.location.href = '/login';\n          return null;\n        }\n        throw new Error(`Failed to fetch permissions: ${response.status}`);\n      }\n      \n      const data = await response.json();\n      \n      // Store permissions object\n      this.permissions = data;\n      \n      // Convert to array of permission names\n      this.permissionArray = Object.values(data);\n      \n      // Cache in localStorage\n      localStorage.setItem('user_permissions', JSON.stringify(data));\n      localStorage.setItem('permissions_array', JSON.stringify(this.permissionArray));\n      \n      console.log(`âœ… Loaded ${this.permissionArray.length} permissions`);\n      \n      return data;\n      \n    } catch (error) {\n      console.error('Error fetching permissions:', error);\n      \n      // Try to use cached permissions\n      return this.loadFromCache();\n    }\n  }\n  \n  /**\n   * Load permissions from cache\n   */\n  loadFromCache() {\n    const cached = localStorage.getItem('user_permissions');\n    \n    if (cached) {\n      this.permissions = JSON.parse(cached);\n      this.permissionArray = Object.values(this.permissions);\n      console.log('ðŸ“¦ Loaded permissions from cache');\n      return this.permissions;\n    }\n    \n    return null;\n  }\n  \n  /**\n   * Check if user has specific permission\n   */\n  hasPermission(permissionName) {\n    if (!this.permissionArray) {\n      this.loadFromCache();\n    }\n    \n    return this.permissionArray.includes(permissionName);\n  }\n  \n  /**\n   * Check if user has ANY of the specified permissions\n   */\n  hasAnyPermission(...permissions) {\n    return permissions.some(perm => this.hasPermission(perm));\n  }\n  \n  /**\n   * Check if user has ALL of the specified permissions\n   */\n  hasAllPermissions(...permissions) {\n    return permissions.every(perm => this.hasPermission(perm));\n  }\n  \n  /**\n   * Check module access\n   */\n  canAccessModule(moduleName) {\n    if (!this.permissionArray) {\n      return false;\n    }\n    \n    // Check if user has any permission for this module\n    return this.permissionArray.some(perm => \n      perm.startsWith(`__JSON:moduleName__.`)\n    );\n  }\n  \n  /**\n   * Check entity access within module\n   */\n  canAccessEntity(moduleName, entityName) {\n    if (!this.permissionArray) {\n      return false;\n    }\n    \n    const prefix = `__JSON:moduleName__.__JSON:entityName__.`;\n    return this.permissionArray.some(perm => perm.startsWith(prefix));\n  }\n  \n  /**\n   * Get all permissions for a module\n   */\n  getModulePermissions(moduleName) {\n    if (!this.permissionArray) {\n      return [];\n    }\n    \n    return this.permissionArray.filter(perm => \n      perm.startsWith(`__JSON:moduleName__.`)\n    );\n  }\n  \n  /**\n   * Get all permissions for an entity\n   */\n  getEntityPermissions(moduleName, entityName) {\n    if (!this.permissionArray) {\n      return [];\n    }\n    \n    const prefix = `__JSON:moduleName__.__JSON:entityName__.`;\n    return this.permissionArray.filter(perm => perm.startsWith(prefix));\n  }\n  \n  /**\n   * Get permission by ID\n   */\n  getPermissionById(id) {\n    return this.permissions ? this.permissions[id] : null;\n  }\n  \n  /**\n   * Get all permission IDs\n   */\n  getPermissionIds() {\n    return this.permissions ? Object.keys(this.permissions) : [];\n  }\n  \n  /**\n   * Clear cached permissions\n   */\n  clear() {\n    this.permissions = null;\n    this.permissionArray = null;\n    localStorage.removeItem('user_permissions');\n    localStorage.removeItem('permissions_array');\n  }\n  \n  /**\n   * Check CRUD permissions for entity\n   */\n  getCrudPermissions(moduleName, entityName) {\n    return {\n      canList: this.hasPermission(`__JSON:moduleName__.__JSON:entityName__.index`),\n      canCreate: this.hasPermission(`__JSON:moduleName__.__JSON:entityName__.store`),\n      canView: this.hasPermission(`__JSON:moduleName__.__JSON:entityName__.show`),\n      canUpdate: this.hasPermission(`__JSON:moduleName__.__JSON:entityName__.update`),\n      canDelete: this.hasPermission(`__JSON:moduleName__.__JSON:entityName__.destroy`)\n    };\n  }\n}\n\n// ============================================\n// USAGE\n// ============================================\n\n// Initialize\nconst permissions = new PermissionManager();\n\n// Fetch on login\nasync function onLoginSuccess() {\n  await permissions.fetchPermissions();\n  \n  // Now build UI based on permissions\n  buildDynamicUI();\n}\n\n// Check specific permission\nif (permissions.hasPermission('__VAR:module__.__VAR:entity__.index')) {\n  console.log('User can list __VAR:entity__');\n  document.getElementById('__VAR:entity__MenuItem').style.display = 'block';\n}\n\n// Check multiple permissions (OR logic)\nif (permissions.hasAnyPermission(\n  '__VAR:module__.__VAR:entity__.store',\n  '__VAR:module__.__VAR:entity__.update'\n)) {\n  console.log('User can create OR update __VAR:entity__');\n  document.getElementById('userFormBtn').style.display = 'block';\n}\n\n// Check multiple permissions (AND logic)\nif (permissions.hasAllPermissions(\n  '__VAR:module__.__VAR:entity__.index',\n  '__VAR:module__.__VAR:entity__.store'\n)) {\n  console.log('User can list AND create users');\n}\n\n// Check module access\nif (permissions.canAccessModule('__VAR:module__')) {\n  console.log('User has access to Security module');\n  document.getElementById('__VAR:module__Module').style.display = 'block';\n}\n\n// Get CRUD capabilities\nconst userPerms = permissions.getCrudPermissions('__VAR:module__', '__VAR:entity__');\nconsole.log('User CRUD permissions:', userPerms);\n// { canList: true, canCreate: true, canView: true, canUpdate: false, canDelete: false }\n\n// Build UI based on permissions\nfunction buildDynamicUI() {\n  // Show/hide create button\n  if (permissions.hasPermission('__VAR:module__.__VAR:entity__.store')) {\n    document.getElementById('create__VAR:entityName__Btn').style.display = 'block';\n  }\n  \n  // Show/hide export buttons\n  if (permissions.hasPermission('__VAR:module__.__VAR:entity__.export-excel')) {\n    document.getElementById('exportExcelBtn').style.display = 'block';\n  }\n  \n  if (permissions.hasPermission('__VAR:module__.__VAR:entity__.export-pdf')) {\n    document.getElementById('exportPdfBtn').style.display = 'block';\n  }\n  \n  // Disable edit buttons if no permission\n  document.querySelectorAll('.edit-__VAR:entity__-btn').forEach(btn => {\n    if (!permissions.hasPermission('__VAR:module__.__VAR:entity__.update')) {\n      btn.disabled = true;\n      btn.title = 'You do not have permission to edit __VAR:entity__';\n    }\n  });\n  \n  // Hide delete buttons if no permission\n  if (!permissions.hasPermission('__VAR:module__.__VAR:entity__.destroy')) {\n    document.querySelectorAll('.delete-user-btn').forEach(btn => {\n      btn.style.display = 'none';\n    });\n  }\n}\n```\n\n```javascript\nimport { useState, useEffect, useContext, createContext } from 'react';\n\n// ============================================\n// PERMISSION CONTEXT\n// ============================================\n\nconst PermissionContext = createContext(null);\n\nexport function PermissionProvider({ children }) {\n  const [permissions, setPermissions] = useState(null);\n  const [loading, setLoading] = useState(true);\n  \n  useEffect(() => {\n    fetchPermissions();\n  }, []);\n  \n  const fetchPermissions = async () => {\n    const token = localStorage.getItem('auth_token');\n    \n    if (!token) {\n      setLoading(false);\n      return;\n    }\n    \n    try {\n      const response = await fetch('/api/permissions', {\n        headers: {\n          'Authorization': `Bearer __JSON:token__`,\n          'Accept': 'application/json'\n        }\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        const permArray = Object.values(data);\n        setPermissions(permArray);\n        localStorage.setItem('permissions_array', JSON.stringify(permArray));\n      }\n    } catch (error) {\n      console.error('Error fetching permissions:', error);\n      \n      // Load from cache\n      const cached = localStorage.getItem('permissions_array');\n      if (cached) {\n        setPermissions(JSON.parse(cached));\n      }\n    } finally {\n      setLoading(false);\n    }\n  };\n  \n  const hasPermission = (permission) => {\n    return permissions?.includes(permission) || false;\n  };\n  \n  const hasAnyPermission = (...perms) => {\n    return perms.some(p => hasPermission(p));\n  };\n  \n  const hasAllPermissions = (...perms) => {\n    return perms.every(p => hasPermission(p));\n  };\n  \n  const value = {\n    permissions,\n    loading,\n    hasPermission,\n    hasAnyPermission,\n    hasAllPermissions,\n    refetch: fetchPermissions\n  };\n  \n  return (\n    <PermissionContext.Provider value={value}>\n      {children}\n    </PermissionContext.Provider>\n  );\n}\n\n// Custom hook\nexport function usePermissions() {\n  const context = useContext(PermissionContext);\n  if (!context) {\n    throw new Error('usePermissions must be used within PermissionProvider');\n  }\n  return context;\n}\n\n// ============================================\n// USAGE IN COMPONENTS\n// ============================================\n\nfunction UsersList() {\n  const { hasPermission, loading } = usePermissions();\n  \n  if (loading) {\n    return <div>Loading permissions...</div>;\n  }\n  \n  return (\n    <div>\n      <h1>__VAR:entityName__</h1>\n      \n      {/* Conditional rendering based on permission */}\n      {hasPermission('__VAR:module__.__VAR:entity__.store') && (\n        <button onClick={createUser}>Create __VAR:entityName__</button>\n      )}\n      \n      {hasPermission('__VAR:module__.__VAR:entity__.export-excel') && (\n        <button onClick={exportExcel}>Export Excel</button>\n      )}\n      \n      {/* User list */}\n      <__VAR:entityName__Table />\n    </div>\n  );\n}\n\nfunction __VAR:entityName__Table() {\n  const { hasPermission } = usePermissions();\n  const canEdit = hasPermission('__VAR:module__.__VAR:entity__.update');\n  const canDelete = hasPermission('__VAR:module__.__VAR:entity__.destroy');\n  \n  return (\n    <table>\n      <tbody>\n        {users.map(__VAR:entity__ => (\n          <tr key={__VAR:entity__.id}>\n            <td>{__VAR:entity__.name}</td>\n            <td>\n              {canEdit && <button>Edit</button>}\n              {canDelete && <button>Delete</button>}\n            </td>\n          </tr>\n        ))}\n      </tbody>\n    </table>\n  );\n}\n\n// Protected Route Component\nfunction ProtectedRoute({ permission, children }) {\n  const { hasPermission, loading } = usePermissions();\n  \n  if (loading) {\n    return <div>Loading...</div>;\n  }\n  \n  if (!hasPermission(permission)) {\n    return <div>Access Denied</div>;\n  }\n  \n  return children;\n}\n\n// Usage\nfunction App() {\n  return (\n    <PermissionProvider>\n      <Router>\n        <Route path=\"/__VAR:entity__\" element={\n          <ProtectedRoute permission=\"__VAR:module__.__VAR:entity__.index\">\n            <__VAR:entityName__List />\n          </ProtectedRoute>\n        } />\n      </Router>\n    </PermissionProvider>\n  );\n}\n```\n\n```javascript\nimport { ref, computed } from 'vue';\n\n// composables/usePermissions.js\nexport function usePermissions() {\n  const permissions = ref([]);\n  const loading = ref(false);\n  \n  const fetchPermissions = async () => {\n    loading.value = true;\n    const token = localStorage.getItem('auth_token');\n    \n    try {\n      const response = await fetch('/api/permissions', {\n        headers: {\n          'Authorization': `Bearer __JSON:token__`,\n          'Accept': 'application/json'\n        }\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        permissions.value = Object.values(data);\n        localStorage.setItem('permissions_array', JSON.stringify(permissions.value));\n      }\n    } catch (error) {\n      console.error(error);\n      const cached = localStorage.getItem('permissions_array');\n      if (cached) {\n        permissions.value = JSON.parse(cached);\n      }\n    } finally {\n      loading.value = false;\n    }\n  };\n  \n  const hasPermission = (permission) => {\n    return permissions.value.includes(permission);\n  };\n  \n  const canEdit = computed(() => \n    hasPermission('__VAR:module__.__VAR:entity__.update')\n  );\n  \n  const canDelete = computed(() => \n    hasPermission('__VAR:module__.__VAR:entity__.destroy')\n  );\n  \n  return {\n    permissions,\n    loading,\n    fetchPermissions,\n    hasPermission,\n    canEdit,\n    canDelete\n  };\n}\n\n// In component\n<script setup>\nimport { usePermissions } from '@/composables/usePermissions';\n\nconst { hasPermission, canEdit, canDelete } = usePermissions();\n</script>\n\n<template>\n  <div>\n    <button v-if=\"hasPermission('__VAR:module__.__VAR:entity__.store')\">\n      Create __VAR:entityName__\n    </button>\n    \n    <button v-if=\"canEdit\">Edit</button>\n    <button v-if=\"canDelete\">Delete</button>\n  </div>\n</template>\n```\n\n```bash\ncurl -X GET https://api.example.com/api/permissions \\\n  -H \"Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGc...\" \\\n  -H \"Accept: application/json\"\n\n{\n  \"238\": \"__VAR:module__.__VAR:entity__.action-validate\",\n  \"244\": \"__VAR:module__.__VAR:entity__.index\",\n  \"245\": \"__VAR:module__.__VAR:entity__.store\",\n  ...\n}\n```\n\n```php\n<?php\n\nnamespace App\\Http\\Controllers;\n\nuse Illuminate\\Http\\JsonResponse;\n\nclass PermissionController extends Controller\n{\n    /**\n     * Get authenticated user's permissions\n     */\n    public function index(): JsonResponse\n    {\n        $user = auth()->user();\n        \n        // Get all user permissions through roles\n        $permissions = $user->getAllPermissions()\n            ->pluck('name', 'id')\n            ->toArray();\n        \n        // Return as object (not wrapped in 'data')\n        return response()->json($permissions);\n    }\n}\n```\n\n```python\nimport requests\n\nclass PermissionManager:\n    def __init__(self, api_url, token):\n        self.api_url = api_url\n        self.token = token\n        self.permissions = None\n        self.permission_list = []\n    \n    def fetch_permissions(self):\n        \"\"\"Fetch user permissions from API\"\"\"\n        headers = {\n            'Authorization': f'Bearer {self.token}',\n            'Accept': 'application/json'\n        }\n        \n        try:\n            response = requests.get(\n                f'{self.api_url}/permissions',\n                headers=headers\n            )\n            \n            if response.status_code == 200:\n                self.permissions = response.json()\n                self.permission_list = list(self.permissions.values())\n                print(f'âœ… Loaded {len(self.permission_list)} permissions')\n                return True\n            else:\n                print(f'âŒ Failed: {response.status_code}')\n                return False\n                \n        except Exception as e:\n            print(f'Error: {e}')\n            return False\n    \n    def has_permission(self, permission_name):\n        \"\"\"Check if user has specific permission\"\"\"\n        return permission_name in self.permission_list\n    \n    def can_access_module(self, module_name):\n        \"\"\"Check if user can access module\"\"\"\n        return any(\n            perm.startswith(f'{module_name}.')\n            for perm in self.permission_list\n        )\n    \n    def get_crud_permissions(self, module, entity):\n        \"\"\"Get CRUD permissions for entity\"\"\"\n        prefix = f'{module}.{entity}.'\n        return {\n            'can_list': self.has_permission(f'{prefix}index'),\n            'can_create': self.has_permission(f'{prefix}store'),\n            'can_view': self.has_permission(f'{prefix}show'),\n            'can_update': self.has_permission(f'{prefix}update'),\n            'can_delete': self.has_permission(f'{prefix}destroy')\n        }\n\npm = PermissionManager('https://api.example.com/api', 'your-token-here')\npm.fetch_permissions()\n\nif pm.has_permission('__VAR:module__.__VAR:entity__.index'):\n    print('User can list __VAR:entity__')\n\nperms = pm.get_crud_permissions('__VAR:module__', '__VAR:entity__')\nprint(f'User permissions: {perms}')\n```\n\n\n\n**Client-Side Caching:**\n- Cache permissions in localStorage after fetch\n- Use cached version if API call fails\n- Refresh on login/token refresh\n- Clear on logout\n\n**Cache Invalidation:**\n```javascript\n// Refresh permissions when:\n// 1. After login\nawait login(email, password);\nawait fetchPermissions();\n\n// 2. After role change (if your app supports it)\nsocket.on('permissions-updated', () => {\n  fetchPermissions();\n});\n\n// 3. On token refresh\nawait refreshToken();\nawait fetchPermissions();\n\n// 4. Clear on logout\nlogout();\npermissions.clear();\n```\n\n\n**CRITICAL:** Client-side permission checks are for UI/UX only!\n\n```javascript\n// âœ… GOOD: Use for UI control\nif (hasPermission('__VAR:entity__.delete')) {\n  showDeleteButton();  // Show button\n}\n\n// âŒ INSUFFICIENT: Server must ALSO check\nasync function deleteUser(id) {\n  // Client thinks user has permission\n  // But server MUST validate again!\n  await api.delete(`/__VAR:entity__/__JSON:id__`);  // Server checks permission\n}\n```\n\n**Defense in Depth:**\n```\n1. Client checks permission â†’ Hide/Show UI\n2. Server checks permission â†’ Authorize API call\n3. Database checks constraint â†’ Enforce data integrity\n```\n\n\n**What if user modifies localStorage?**\n\n```javascript\n// Malicious user tries:\nlocalStorage.setItem('permissions_array', JSON.stringify([\n  '__VAR:module__.__VAR:entity__.destroy',  // Fake permission\n  'admin.full-access'            // Fake permission\n]));\n```\n\n**Result:** UI shows delete button, BUT:\n- Server still validates on API call\n- API returns 403 Forbidden\n- Action is blocked\n\n**Takeaway:** Client permissions are UI hints, NOT security boundaries.\n\n\n```php\n// âŒ BAD: Trust client\npublic function deleteUser(Request $request, $id) {\n    // No permission check - VULNERABLE!\n    User::find($id)->delete();\n}\n\n// âœ… GOOD: Always validate server-side\npublic function deleteUser(Request $request, $id) {\n    // Server-side authorization\n    $this->authorize('delete', User::find($id));\n    \n    User::find($id)->delete();\n}\n```\n\n\n**Cause:** User role has no permissions assigned\n\n**Solutions:**\n1. Check user's role in database\n2. Verify role has permissions attached\n3. Ensure permission sync completed\n4. Contact administrator to assign permissions\n\n**Debug:**\n```javascript\nconst perms = await fetchPermissions();\nconsole.log('Permissions count:', Object.keys(perms).length);\nconsole.log('User roles:', userData.roles);\n```\n\n**Cause:** Cached permissions outdated\n\n**Solutions:**\n1. Clear localStorage and refetch\n2. Implement auto-refresh on role change\n3. Add version check to cached permissions\n\n**Fix:**\n```javascript\n// Add version to cached permissions\nlocalStorage.setItem('permissions_version', Date.now());\n\n// Check version on load\nconst version = localStorage.getItem('permissions_version');\nconst age = Date.now() - parseInt(version);\n\nif (age > 3600000) { // 1 hour\n  fetchPermissions();  // Refresh if old\n}\n```\n\n**Cause:** Token invalid or expired\n\n**Solutions:**\n1. Refresh token first\n2. If refresh fails, redirect to login\n3. Check token format in Authorization header\n\n**Implementation:**\n```javascript\nasync function fetchPermissions() {\n  try {\n    const response = await fetch('/api/permissions', {\n      headers: { 'Authorization': `Bearer __JSON:token__` }\n    });\n    \n    if (response.status === 401) {\n      // Try refresh\n      const newToken = await refreshToken();\n      if (newToken) {\n        return fetchPermissions(); // Retry\n      } else {\n        redirectToLogin(); // Refresh failed\n      }\n    }\n    \n    return await response.json();\n  } catch (error) {\n    console.error(error);\n  }\n}\n```\n\n**Cause:** Using incorrect dot notation\n\n**Examples:**\n```javascript\n// âŒ WRONG formats\nhasPermission('users.index')              // Missing module\nhasPermission('__VAR:module__-__VAR:entity__-index') // Wrong separator\nhasPermission('__VAR:module__.__VAR:entity__')       // Missing action\nhasPermission('__VAR:module__.__VAR:ENTITY__.INDEX') // Wrong case\n\n// âœ… CORRECT format\nhasPermission('__VAR:module__.__VAR:entity__.index')\n```\n\n**Cause:** Checking permissions repeatedly in loops\n\n**Solution:** Check once, cache result\n\n```javascript\n// âŒ BAD: Check in loop\nusers.forEach(user => {\n  if (hasPermission('__VAR:module__.__VAR:entity__.update')) { // Called 100 times!\n    showEditButton(user);\n  }\n});\n\n// âœ… GOOD: Check once\nconst canEdit = hasPermission('__VAR:module__.__VAR:entity__.update');\nusers.forEach(__VAR:entity__ => {\n  if (canEdit) { // Simple boolean check\n    showEditButton(__VAR:entity__);\n  }\n});\n```\n\n\n\n1. **Fetch on Login**\n   ```javascript\n   async function onLogin() {\n     await login(email, password);\n     await fetchPermissions();  // Immediately after login\n     buildUI();\n   }\n   ```\n\n2. **Cache Wisely**\n   ```javascript\n   // Cache for offline/failover\n   localStorage.setItem('permissions', JSON.stringify(perms));\n   \n   // But refresh periodically\n   setInterval(fetchPermissions, 3600000); // Every hour\n   ```\n\n3. **Check Before Action**\n   ```javascript\n   function onDeleteClick(__VAR:entity__Id) {\n     if (!hasPermission('__VAR:module__.__VAR:entity__.destroy')) {\n       alert('No permission');\n       return;\n     }\n     deleteUser(__VAR:entity__Id);\n   }\n   ```\n\n4. **Use Computed Properties**\n   ```javascript\n   // React\n   const canEdit = useMemo(() => \n     hasPermission('__VAR:module__.__VAR:entity__.update'),\n     [permissions]\n   );\n   \n   // Vue\n   const canEdit = computed(() => \n     hasPermission('__VAR:module__.__VAR:entity__.update')\n   );\n   ```\n\n5. **Graceful Degradation**\n   ```javascript\n   // If permissions fail to load, use safe defaults\n   if (!permissions) {\n     // Show limited UI\n     return <ReadOnlyView />;\n   }\n   ```\n\n\n1. **Always Authorize**\n   ```php\n   // NEVER skip authorization\n   public function update(Request $request, $id) {\n     $this->authorize('update', __VAR:entityName__::find($id));\n     // ... update logic\n   }\n   ```\n\n2. **Return Flat Structure**\n   ```php\n   // âœ… GOOD: Flat object\n   return response()->json($permissions->pluck('name', 'id'));\n   \n   // âŒ BAD: Nested structure\n   return response()->json(['data' => $permissions]);\n   ```\n\n3. **Cache Server-Side**\n   ```php\n   // Cache user permissions for 1 hour\n   $permissions = Cache::remember(\n     \"user_{$userId}_permissions\",\n     3600,\n     fn() => $user->getAllPermissions()\n   );\n   ```\n\n4. **Include All Inherited Permissions**\n   ```php\n   // Include role permissions + direct permissions\n   $allPermissions = $user->getAllPermissions();\n   ```\n\n5. **Log Permission Checks**\n   ```php\n   // Log failed authorization attempts\n   Log::warning('Unauthorized access attempt', [\n     'user' => $userId,\n     'permission' => $permission,\n     'ip' => $request->ip()\n   ]);\n   ```\n\n\n```javascript\nfunction buildMenu() {\n  const menu = [];\n  \n  // Security module\n  if (permissions.canAccessModule('__VAR:module__')) {\n    const securityMenu = {\n      label: 'Security',\n      items: []\n    };\n    \n    if (permissions.hasPermission('__VAR:module__.__VAR:entity__.index')) {\n      securityMenu.items.push({ label: '__VAR:entityName__', link: '/__VAR:entity__' });\n    }\n    \n    if (permissions.hasPermission('__VAR:module__.__VAR:other_entity__.index')) {\n      securityMenu.items.push({ label: '__VAR:otherEntityName__', link: '/__VAR:other_entity__' });\n    }\n    \n    if (securityMenu.items.length > 0) {\n      menu.push(securityMenu);\n    }\n  }\n  \n  return menu;\n}\n```\n\n```javascript\nfunction UserRow({ user }) {\n  const { hasPermission } = usePermissions();\n  \n  return (\n    <tr>\n      <td>{user.name}</td>\n      <td>\n        {hasPermission('__VAR:module__.__VAR:entity__.show') && (\n          <button onClick={() => viewUser(__VAR:entity__.id)}>View</button>\n        )}\n        \n        {hasPermission('__VAR:module__.__VAR:entity__.update') && (\n          <button onClick={() => editUser(__VAR:entity__.id)}>Edit</button>\n        )}\n        \n        {hasPermission('__VAR:module__.__VAR:entity__.destroy') && (\n          <button onClick={() => deleteUser(__VAR:entity__.id)}>Delete</button>\n        )}\n      </td>\n    </tr>\n  );\n}\n```\n\n```javascript\nfunction BulkActionsToolbar({ selectedIds }) {\n  const { hasPermission } = usePermissions();\n  \n  return (\n    <div className=\"bulk-actions\">\n      {hasPermission('__VAR:module__.__VAR:entity__.update-multiple') && (\n        <button onClick={() => bulkUpdate(selectedIds)}>\n          Bulk Update\n        </button>\n      )}\n      \n      {hasPermission('__VAR:module__.__VAR:entity__.delete-by-id') && (\n        <button onClick={() => bulkDelete(selectedIds)}>\n          Bulk Delete\n        </button>\n      )}\n      \n      {hasPermission('__VAR:module__.__VAR:entity__.export-excel') && (\n        <button onClick={() => exportSelected(selectedIds, 'excel')}>\n          Export Excel\n        </button>\n      )}\n    </div>\n  );\n}\n```\n\n```javascript\nfunction ProtectedRoute({ permission, children }) {\n  const { hasPermission, loading } = usePermissions();\n  const navigate = useNavigate();\n  \n  useEffect(() => {\n    if (!loading && !hasPermission(permission)) {\n      navigate('/unauthorized');\n    }\n  }, [loading, permission]);\n  \n  if (loading) return <Spinner />;\n  if (!hasPermission(permission)) return null;\n  \n  return children;\n}\n\n// Usage\n<Route path=\"/__VAR:entity__\" element={\n  <ProtectedRoute permission=\"__VAR:module__.__VAR:entity__.index\">\n    <__VAR:entityName__Page />\n  </ProtectedRoute>\n} />\n```\n\n\n| Code | Meaning | When | Client Action |\n|------|---------|------|---------------|\n| **200** | Success | Permissions retrieved | Store and use for UI |\n| **401** | Unauthorized | No valid token | Redirect to login |\n| **403** | Forbidden | No permission to view permissions | Contact admin |\n| **500** | Server Error | Unexpected error | Use cached permissions, retry |\n\n\n- `POST /api/login` - Authenticate (get token)\n- `GET /api/user` - Get current user data\n- `POST /api/refresh` - Refresh authentication token\n- `POST /api/logout` - Logout (invalidate token)\n- `GET /api/permissions/modules` - Get available modules list\n\n\n**Minimal Working Example:**\n```javascript\n// Fetch permissions\nconst response = await fetch('/api/permissions', {\n  headers: { 'Authorization': `Bearer __JSON:token__` }\n});\nconst permissions = await response.json();\n\n// Store\nconst permArray = Object.values(permissions);\nlocalStorage.setItem('permissions', JSON.stringify(permArray));\n\n// Check\nconst hasPermission = (perm) => permArray.includes(perm);\n\n// Use\nif (hasPermission('__VAR:module__.__VAR:entity__.index')) {\n  showUsersMenu();\n}\n```\n\n\n- **Client permissions are UI hints, NOT security boundaries**\n- **Server must ALWAYS validate permissions on API calls**\n- **Cache permissions but refresh periodically**\n- **Clear permissions on logout**\n- **Permission format:** `{module}.{entity}.{action}`\n- **Response is flat object, not wrapped in `data`**\n- **Keys are string IDs, values are permission names**\n- **Fetch immediately after login**\n- **Use for showing/hiding UI elements**\n- **Never trust client-side checks for security**\n",
    "tags": [
        "Authorization",
        "Permissions"
    ],
    "requestBody": {
        "required": false,
        "description": "No request body required. User identification comes from authentication token."
    },
    "responses": {
        "200": {
            "description": "Successfully retrieved user permissions.\n\nReturns a flat JSON object where:\n- Keys are permission IDs (as strings)\n- Values are permission names in dot notation: `{module}.{entity}.{action}`\n\n**Important Notes:**\n- Response is NOT wrapped in `data` key\n- Keys are strings even though they represent integer IDs\n- Order is not guaranteed\n- Size varies based on user's assigned roles\n",
            "content": {
                "application/json": {
                    "schema": {
                        "type": "object",
                        "additionalProperties": {
                            "type": "string",
                            "description": "Permission name in format {module}.{entity}.{action} that user can access"
                        }
                    },
                    "examples": {
                        "admin_user": {
                            "summary": "Admin User (Full Permissions)",
                            "value": {
                                "1": "auths.login",
                                "2": "auths.admin-login",
                                "3": "auths.register",
                                "7": "auths.logout",
                                "8": "auths.refresh",
                                "9": "auths.user-profile",
                                "10": "permissions.modules",
                                "238": "__VAR:module__.roles.action-validate",
                                "239": "__VAR:module__.roles.update-multiple",
                                "240": "__VAR:module__.roles.export-excel",
                                "241": "__VAR:module__.roles.export-pdf",
                                "242": "__VAR:module__.roles.delete-by-id",
                                "244": "__VAR:module__.roles.index",
                                "245": "__VAR:module__.roles.store",
                                "243": "__VAR:module__.roles.update",
                                "247": "__VAR:module__.roles.destroy",
                                "248": "__VAR:module__.users.action-validate",
                                "249": "__VAR:module__.users.update-multiple",
                                "250": "__VAR:module__.users.export-excel",
                                "251": "__VAR:module__.users.export-pdf",
                                "252": "__VAR:module__.users.delete-by-id",
                                "254": "__VAR:module__.users.index",
                                "255": "__VAR:module__.users.store",
                                "256": "__VAR:module__.users.show",
                                "257": "__VAR:module__.users.destroy"
                            }
                        },
                        "regular_user": {
                            "summary": "Regular User (Limited Permissions)",
                            "value": {
                                "1": "auths.login",
                                "7": "auths.logout",
                                "8": "auths.refresh",
                                "9": "auths.user-profile",
                                "254": "__VAR:module__.users.index",
                                "256": "__VAR:module__.users.show"
                            }
                        },
                        "readonly_user": {
                            "summary": "Read-Only User",
                            "value": {
                                "1": "auths.login",
                                "7": "auths.logout",
                                "9": "auths.user-profile",
                                "244": "__VAR:module__.roles.index",
                                "254": "__VAR:module__.users.index",
                                "256": "__VAR:module__.users.show"
                            }
                        }
                    }
                }
            }
        },
        "401": {
            "description": "Unauthorized - No valid authentication token provided.\n\n**Common causes:**\n- Authorization header missing\n- Token invalid or expired\n- Token revoked (user logged out)\n- Token format incorrect\n\n**Client action:**\n- Redirect to login page\n- Clear stored authentication data\n- Request new authentication\n",
            "content": {
                "application/json": {
                    "schema": {
                        "type": "object",
                        "properties": {
                            "message": {
                                "type": "string",
                                "example": "Unauthenticated."
                            }
                        }
                    },
                    "examples": {
                        "missing_token": {
                            "summary": "Missing Authorization Header",
                            "value": {
                                "message": "Unauthenticated."
                            }
                        },
                        "invalid_token": {
                            "summary": "Invalid or Expired Token",
                            "value": {
                                "message": "Token is invalid."
                            }
                        },
                        "revoked_token": {
                            "summary": "Token Revoked (Logged Out)",
                            "value": {
                                "message": "Token has been revoked."
                            }
                        }
                    }
                }
            }
        },
        "403": {
            "description": "Forbidden - User does not have permission to view permissions list.\n\n**Rare scenario:** Only occurs if user authenticated but permission system\nrestricts access to viewing their own permissions.\n\n**Client action:**\n- Display \"Access Denied\" message\n- Contact administrator\n- User may need role/permission update\n",
            "content": {
                "application/json": {
                    "schema": {
                        "type": "object",
                        "properties": {
                            "message": {
                                "type": "string",
                                "example": "This action is unauthorized."
                            }
                        }
                    }
                }
            }
        },
        "500": {
            "description": "Internal Server Error - Unexpected error retrieving permissions.\n\n**Possible causes:**\n- Database connection failure\n- Permission system configuration error\n- Role/permission relationship corruption\n\n**Client action:**\n- Retry request once\n- Use cached permissions if available\n- Contact support with error_id\n- If persistent, user may need to re-login\n",
            "content": {
                "application/json": {
                    "schema": {
                        "type": "object",
                        "properties": {
                            "message": {
                                "type": "string",
                                "example": "Unable to retrieve permissions."
                            },
                            "error_id": {
                                "type": "string",
                                "description": "Error tracking ID for support",
                                "example": "err_perm_abc123"
                            }
                        }
                    }
                }
            }
        }
    }
}